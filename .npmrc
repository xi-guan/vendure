# pnpm configuration
# https://pnpm.io/npmrc

# Use strict peer dependencies to catch issues early
strict-peer-dependencies=false

# Enable shamefully-hoist for compatibility with tools that don't support pnpm structure
# This helps with some Angular CLI and other tooling compatibility
# Temporarily enabled to address phantom dependencies during migration
# TODO: Incrementally fix phantom dependencies and switch back to false
shamefully-hoist=true

# Public hoist pattern for specific packages that need to be hoisted
# These packages need to be hoisted to avoid type resolution issues
public-hoist-pattern[]=*graphql*
public-hoist-pattern[]=*@graphql-tools*
public-hoist-pattern[]=*@nestjs*
public-hoist-pattern[]=*typeorm*

# Automatically install peer dependencies
auto-install-peers=true

# Link workspace packages
link-workspace-packages=true

# Save exact versions (no ^ or ~)
save-exact=false

# Use lockfile v6 format (pnpm 8+)
lockfile=true

# Node linker (default is isolated, use hoisted if compatibility issues arise)
node-linker=isolated

# Store directory (use default ~/.pnpm-store)
# store-dir=~/.pnpm-store

# Virtual store directory
virtual-store-dir=node_modules/.pnpm

# Symlink node_modules
symlink=true

# Enable side-effects cache for faster installs
side-effects-cache=true

# Prefer frozen lockfile in CI (will be set via command line in CI)
# frozen-lockfile=true

# Enable build scripts for necessary packages (Prisma, esbuild, etc.)
enable-pre-post-scripts=true

# Allow specific packages to run install scripts
# This is required for native modules like bcrypt, sharp, etc.
ignore-scripts=false

# Auto-approve all build scripts (pnpm v10+)
# In production, you should review and approve each package individually
# For CI/CD, this is safe as we control the lockfile
unsafe-perm=true

# Skip Chromium download for puppeteer (use system Chrome in CI/CD)
# This prevents network issues during install and reduces package size
# Chrome/Chromium should be pre-installed in CI/CD environments
PUPPETEER_SKIP_CHROMIUM_DOWNLOAD=true

# ============================================
# Performance Optimizations
# ============================================

# Network concurrency for faster downloads
network-concurrency=16

# Fetch retry configuration
fetch-retries=3
fetch-retry-factor=10
fetch-retry-mintimeout=10000
fetch-retry-maxtimeout=60000

# Resolution mode (highest = faster, latest = slower but more accurate)
resolution-mode=highest

# Logging level (less logging = faster)
loglevel=warn

# Enable package import method (clone-or-copy is faster)
package-import-method=auto

# Store configuration for faster CI
# Uncomment for shared CI cache
# store-dir=.pnpm-store
